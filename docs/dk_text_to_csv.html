<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DK Text → CSV</title>
</head>
<body>

<h1>DraftKings Text → CSV</h1>

<label>League</label>
<select id="league">
  <option value="">-- Select League --</option>
  <option value="nhl">NHL</option>
  <option value="nba">NBA</option>
  <option value="ncaab">NCAAB</option>
  <option value="soc">Soccer</option>
</select>

<label>GitHub Token (Classic PAT)</label>
<input type="password" id="token" />

<label>Paste DraftKings Text</label>
<textarea id="rawText" rows="15"></textarea>

<button onclick="submitJob()">Generate CSV</button>

<pre id="status"></pre>

<script>
const owner = "Clownworldenjoyer76";
const repo = "bet_tracker";

/*
CRITICAL FIX:
Use WORKFLOW ID, not filename.
This avoids GitHub returning 422 even when workflow_dispatch exists.
*/
const workflowId = "dk_text_to_csv"; // <-- workflow ID (no .yml)

async function submitJob() {
  const league = document.getElementById("league").value;
  const token = document.getElementById("token").value.trim();
  const rawText = document.getElementById("rawText").value;
  const status = document.getElementById("status");

  if (!league || !token || !rawText) {
    alert("Missing input");
    return;
  }

  const res = await fetch(
    `https://api.github.com/repos/${owner}/${repo}/actions/workflows/${workflowId}/dispatches`,
    {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Accept": "application/vnd.github+json"
      },
      body: JSON.stringify({
        ref: "main",
        inputs: {
          league,
          raw_text: rawText,
          run_id: Date.now().toString()
        }
      })
    }
  );

  const text = await res.text();
  status.textContent = `status=${res.status}\n${text}`;
}
</script>

</body>
</html>
