name: 2000-Player Pool Simulation

on:
  workflow_dispatch:
    inputs:
      opponent_model:
        description: "Opponent pick model"
        required: true
        default: "uniform"
        type: choice
        options:
          - uniform
          - ev_biased
          - tier_biased
      players:
        description: "Total players in pool"
        required: true
        default: "2000"
      olympics:
        description: "Number of simulated Olympics"
        required: true
        default: "10000"
      lineup:
        description: "Comma-separated 6-country lineup"
        required: true
        default: "Germany,Norway,USA,Canada,Kazakhstan,Croatia"

jobs:
  simulate:
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install numpy pandas

      - name: Ensure output directory exists
        run: |
          mkdir -p testing/olympics

      - name: Run pool simulation and write CSV
        run: |
          python scripts/simulate_pool_winprob.py \
            --opponent_model "${{ github.event.inputs.opponent_model }}" \
            --players "${{ github.event.inputs.players }}" \
            --olympics "${{ github.event.inputs.olympics }}" \
            --lineup "${{ github.event.inputs.lineup }}" \
            > testing/olympics/pool_sim_results.csv

      - name: Upload CSV results
        uses: actions/upload-artifact@v4
        with:
          name: pool-simulation-csv
          path: testing/olympics/pool_sim_results.csv
