name: 09 AUTORUN DK_01 Text to CSV

on:
  workflow_dispatch:
    inputs:
      league:
        required: true
        type: string
      raw_text:
        required: true
        type: string

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Validate league
        shell: bash
        run: |
          case "${{ inputs.league }}" in
            nba|ncaab|nhl|nfl|soc|mls|mlb) ;;
            *) echo "invalid league"; exit 1 ;;
          esac

      - name: Write raw text
        shell: bash
        env:
          RAW_TEXT: ${{ inputs.raw_text }}
        run: |
          mkdir -p docs/win/manual
          printf '%s\n' "$RAW_TEXT" > raw.txt

      - name: Parse DK text
        shell: bash
        env:
          LEAGUE: ${{ inputs.league }}
        run: |
          python3 scripts/dk_text_to_csv.py

      - name: Commit CSV
        shell: bash
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add docs/win/manual/*.csv
          git commit -m "Add DK CSV (${{ inputs.league }})" || true
          git push
